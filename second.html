<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Station Dashboard</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background:#f4f6f8; color: #333; }
    h2 { text-align:center; color: #2c3e50; }
    .card {
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    #readings { font-size: 1.1rem; line-height: 1.6; color: #2980b9; }
    .btn-back {
        padding: 10px 20px;
        background: #95a5a6;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        display: inline-block;
        margin-bottom: 20px;
    }
    canvas { max-height: 250px; }
  </style>
</head>

<body>

<a href="index.html" class="btn-back">‚¨Ö Back to Home</a>
<h2>ESP32 Weather & Water Dashboard</h2>

<div class="card">
  <h3>Live Status</h3>
  <div id="readings">Connecting to Firebase...</div>
</div>

<div class="card">
  <h3>Temperature (¬∞C)</h3>
  <canvas id="tempChart"></canvas>
</div>

<div class="card">
  <h3>Humidity (%)</h3>
  <canvas id="humChart"></canvas>
</div>


<script>
/* ===================== FIREBASE CONFIGURATION ===================== */
const firebaseConfig = {
    databaseURL: "https://esp32-dht22-1dcca-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===================== DATA STORAGE ===================== */
let tempData = { labels: [], data: [] };
let humData  = { labels: [], data: [] };


/* ===================== INITIALIZE CHARTS ===================== */
const commonOptions = { 
    responsive: true, 
    maintainAspectRatio: false,
    animation: false, 
    scales: { x: { display: true, title: { display: true, text: 'Time' } } } 
};

const tempChart = new Chart(document.getElementById('tempChart'), {
    type: 'line',
    data: { labels: tempData.labels, datasets: [{ label: 'Temp ¬∞C', data: tempData.data, borderColor: '#e74c3c', tension: 0.3, fill: true, backgroundColor: 'rgba(231, 76, 60, 0.1)' }] },
    options: commonOptions
});

const humChart = new Chart(document.getElementById('humChart'), {
    type: 'line',
    data: { labels: humData.labels, datasets: [{ label: 'Humidity %', data: humData.data, borderColor: '#3498db', tension: 0.3, fill: true, backgroundColor: 'rgba(52, 152, 219, 0.1)' }] },
    options: commonOptions
});


/* ===================== LIVE DATA FETCH FROM FIREBASE ===================== */
// This listens to your "esp32" node in the database
db.ref("esp32").on("value", (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    const ts = new Date().toLocaleTimeString();
    
    // Update Numeric Text
    document.getElementById('readings').innerHTML = `
        <strong>Last Sync:</strong> ${ts}<br>
        üå°Ô∏è <strong>Temp:</strong> ${data.temp ?? '--'}¬∞C | 
        üíß <strong>Humidity:</strong> ${data.hum ?? '--'}% 
    `;

    // Update Temperature Chart
    tempData.labels.push(ts);
    tempData.data.push(data.temp);
    if (tempData.labels.length > 20) { tempData.labels.shift(); tempData.data.shift(); }
    tempChart.update();

    // Update Humidity Chart
    humData.labels.push(ts);
    humData.data.push(data.hum);
    if (humData.labels.length > 20) { humData.labels.shift(); humData.data.shift(); }
    humChart.update();
});
</script>
<div class="card">
  <h3>City-wise Temperature & Humidity</h3>
  <table style="width:100%; border-collapse: collapse; text-align:center;">
    <tr style="background:#ecf0f1;">
      <th style="border:1px solid #ccc; padding:10px;">City</th>
      <th style="border:1px solid #ccc; padding:10px;">Temperature (¬∞C)</th>
      <th style="border:1px solid #ccc; padding:10px;">Humidity (%)</th>
    </tr>
    <tr>
      <td style="border:1px solid #ccc; padding:10px;">Mumbai</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
    </tr>
    <tr>
      <td style="border:1px solid #ccc; padding:10px;">Delhi</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
    </tr>
    <tr>
      <td style="border:1px solid #ccc; padding:10px;">Pune</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
    </tr>
    <tr>
      <td style="border:1px solid #ccc; padding:10px;">Bangalore</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
      <td style="border:1px solid #ccc; padding:10px;">--</td>
    </tr>
  </table>
</div>


<button class="btn" onclick="location.href='third.html'" style="float: right; font-size: 18px; font-weight: bold; padding: 10px 20px;">Go to Third Page</button>

</body>

</html>
